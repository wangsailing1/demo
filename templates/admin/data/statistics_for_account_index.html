{% extends "../fields.html" %}

{% block fieldbody %}

<!--<p>日期统计(今天每小时更新)</p>-->
<p>日期统计(每小时的半点更新)</p>
<table id="data">
    <tr>
        <th>日期</th>
        <th>登陆用户</th>
        <th>新增登陆</th>
        <th>付费人数</th>
        <th>新增登陆付费人数</th>
        <th>新增付费人数</th>
        <th>留存付费用户</th>
        <th>付费金额</th>
        <th>新增付费金额</th>
        <th>付费率</th>
        <th>付费ARPU</th>
        <th>登陆ARPU</th>
    </tr>
    {% for date, obj in sorted(statistics_data.iteritems(), reverse=True) %}
    {% if obj %}
    <tr onmouseover="return changecolor(this, '#B3D9D9')" onmouseout="return changecolor(this, '')">
        <td>{{ date }}</td>
        <td>{{ obj['login_num'] }}</td>
        <td>{{ obj['regist_num'] }}</td>
        <td>{{ obj['uid_pay_num'] }}</td>
        <td>{{ obj['regist_uid_pay_num'] }}</td>
        <td>{{ obj['first_uid_pay_num'] }}</td>
        <td>{{ obj['login_uid_pay_num'] }}</td>
        <td>{{ obj['pay_rmb'] }}</td>
        <td>{{ obj['first_uid_pay_rmb'] }}</td>
        <td>{{ obj['pay_rate'] }}</td>
        <td>{{ obj['pay_arpu'] }}</td>
        <td>{{ obj['login_arpu'] }}</td>
    </tr>
    {% end %}
    {% end %}
</table>

<hr/>
<p>日期渠道统计(每小时的半点更新)</p>
<p style="font-size:50%">注: IOS/Android/yingyongbao和以twwn/cnwn开头的渠道为非真实渠道</p>
<form action="/{{url_partition}}/admin/data/statistics_channel/" method="get">
<input type="hidden" name="for_account" value="1">
<table id="data">
<tr>
    <!--<td>
        选择服务器:&nbsp;&nbsp;
        <select name="server_id" value="01">
            <option value="00">所有分服(00)</option>
            {% for server_id, obj in sorted(sc.yield_open_servers(), reverse=True) %}
            {% if server_id == select_server %}
                <option value="{{ server_id }}" selected>{{ obj['name'] }}({{ server_id }})</option>
            {% else %}
                <option value="{{ server_id }}">{{ obj['name'] }}({{ server_id }})</option>
            {% end %}
            {% end %}
        </select>
    </td> -->
    <td>
        选择日期:
        <select name="day" value="1">
            {% for day in sorted(statistics_data, reverse=True) %}
                {% if day == select_day %}
                <option value="{{ day }}" selected>{{ day }}</option>
                {% else %}
                <option value="{{ day }}">{{ day }}</option>
                {% end %}
            {% end %}
        </select>
    </td>
    <td><button type="submit" style="color: red;">查询</button></td>
</tr>
</table>
</form>

<table id="data">
    <tr>
        <th>日期</th>
        <!-- <th>分服</th> -->
        <th>渠道</th>
        <th>登陆用户</th>
        <th>新增登陆</th>
        <th>付费人数</th>
        <th>新增登陆付费人数</th>
        <th>新增付费人数</th>
        <th>留存付费用户</th>
        <th>付费金额</th>
        <th>新增付费金额</th>
        <th>付费率</th>
        <th>付费ARPU</th>
        <th>登陆ARPU</th>
    </tr>
    {% set all_login_num = 0 %}
    {% set all_regist_num = 0 %}
    {% set all_uid_pay_num = 0 %}
    {% set all_regist_uid_pay_num = 0 %}
    {% set all_first_uid_pay_num = 0 %}
    {% set all_login_uid_pay_num = 0 %}
    {% set all_pay_rmb = 0 %}
    {% set all_first_uid_pay_rmb = 0 %}
    {% for channel, obj in sorted(channel_data.iteritems(), reverse=False) %}
      {% if 'taiwan' not in url_partition and channel == 'Android' %}
        {% continue %}
      {% end %}
      {% if obj %}
          {% set all_login_num += obj['login_num'] %}
          {% set all_regist_num += obj['regist_num'] %}
          {% set all_uid_pay_num += obj['uid_pay_num'] %}
          {% set all_regist_uid_pay_num += obj['regist_uid_pay_num'] %}
          {% set all_first_uid_pay_num += obj['first_uid_pay_num'] %}
          {% set all_login_uid_pay_num += obj['login_uid_pay_num'] %}
          {% set all_pay_rmb += obj['pay_rmb'] %}
          {% set all_first_uid_pay_rmb += obj['first_uid_pay_rmb'] %}
      <tr onmouseover="return changecolor(this, '#B3D9D9')" onmouseout="return changecolor(this, '')">
          <td>{{ select_day }}</td>
          <!-- <td>{{ select_server }}</td> -->
          <td>{{ get_channel_name(channel) }}</td>
          <td>{{ obj['login_num'] }}</td>
          <td>{{ obj['regist_num'] }}</td>
          <td>{{ obj['uid_pay_num'] }}</td>
          <td>{{ obj['regist_uid_pay_num'] }}</td>
          <td>{{ obj['first_uid_pay_num'] }}</td>
          <td>{{ obj['login_uid_pay_num'] }}</td>
          <td>{{ obj['pay_rmb'] }}</td>
          <td>{{ obj['first_uid_pay_rmb'] }}</td>
          <td>{{ obj['pay_rate'] }}</td>
          <td>{{ obj['pay_arpu'] }}</td>
          <td>{{ obj['login_arpu'] }}</td>
      </tr>
      {% end %}
    {% end %}
    <!--
    {% if channel_data and channel_data.get('ioskvgames') and channel_data.get('cnwnios') %}
    <tr onmouseover="return changecolor(this, '#B3D9D9')" onmouseout="return changecolor(this, '')">
        <td>{{ select_day }}</td>
        <td>cnwnioshd</td>
        <td>{{ channel_data['ioskvgames']['login_num'] - channel_data['cnwnios']['login_num'] }}</td>
        <td>{{ channel_data['ioskvgames']['regist_num'] - channel_data['cnwnios']['regist_num'] }}</td>
        <td>{{ channel_data['ioskvgames']['uid_pay_num'] - channel_data['cnwnios']['uid_pay_num'] }}</td>
        <td>{{ channel_data['ioskvgames']['regist_uid_pay_num'] - channel_data['cnwnios']['regist_uid_pay_num'] }}</td>
        <td>{{ channel_data['ioskvgames']['first_uid_pay_num'] - channel_data['cnwnios']['first_uid_pay_num'] }}</td>
        <td>{{ channel_data['ioskvgames']['login_uid_pay_num'] - channel_data['cnwnios']['login_uid_pay_num'] }}</td>
        <td>{{ channel_data['ioskvgames']['pay_rmb'] - channel_data['cnwnios']['pay_rmb'] }}</td>
        <td>{{ channel_data['ioskvgames']['first_uid_pay_rmb'] - channel_data['cnwnios']['first_uid_pay_rmb'] }}</td>
        <td>-</td>
        <td>-</td>
        <td>-</td>
    </tr>
    {% end %}
    -->

    <tr onmouseover="return changecolor(this, '#B3D9D9')" onmouseout="return changecolor(this, '')">
        <td>总计</td>
        <!-- <td>{{ select_server }}</td> -->
        <td> </td>
        <td>{{ all_login_num }}</td>
        <td>{{ all_regist_num }}</td>
        <td>{{ all_uid_pay_num }}</td>
        <td>{{ all_regist_uid_pay_num }}</td>
        <td>{{ all_first_uid_pay_num }}</td>
        <td>{{ all_login_uid_pay_num }}</td>
        <td>{{ all_pay_rmb }}</td>
        <td>{{ all_first_uid_pay_rmb }}</td>
        <td> </td>
        <td> </td>
        <td> </td>
    </tr>
</table>

<hr/>
<p>单渠道统计</p>
<form action="/{{url_partition}}/admin/data/statistics_channel_for_one/?show_all={{show_all2}}" method="get">
<table id="data">
    <tr>
        <td>
            选择截止日期:
            <select name="one_end_day" value="1">
                {% for day in sorted(statistics_data, reverse=True) %}
                    {% if day == select_one_end_day %}
                    <option value="{{ day }}" selected>{{ day }}</option>
                    {% else %}
                    <option value="{{ day }}">{{ day }}</option>
                    {% end %}
                {% end %}
            </select>
        </td>
        <td>
            选择平台:
            <select name="channel_id" value="1">
                {% for channel in sorted(channel_ids, reverse=True) %}
                    {% if channel == select_channel_id %}
                    <option value="{{ channel }}" selected>{{ get_channel_name(channel) }}</option>
                    {% else %}
                    <option value="{{ channel }}">{{ get_channel_name(channel) }}</option>
                    {% end %}
                {% end %}
            </select>
        </td>
        <td><button type="submit" style="color: red;">查询</button></td>
    </tr>
</table>
</form>

<table id="data">
    <tr>
        <th>日期</th>
        <th>渠道</th>
        <th>登陆用户</th>
        <th>新增登陆</th>
        <th>付费人数</th>
        <th>新增登陆付费人数</th>
        <th>新增付费人数</th>
        <th>留存付费用户</th>
        <th>付费金额</th>
        <th>新增付费金额</th>
        <th>付费率</th>
        <th>付费ARPU</th>
        <th>登陆ARPU</th>
    </tr>
    {% set all_login_num = 0 %}
    {% set all_regist_num = 0 %}
    {% set all_uid_pay_num = 0 %}
    {% set all_regist_uid_pay_num = 0 %}
    {% set all_first_uid_pay_num = 0 %}
    {% set all_login_uid_pay_num = 0 %}
    {% set all_pay_rmb = 0 %}
    {% set all_first_uid_pay_rmb = 0 %}
    {% for day, obj in sorted(one_channel_data.iteritems(), reverse=False) %}
        {% if obj %}
            {% set all_login_num += obj['login_num'] %}
            {% set all_regist_num += obj['regist_num'] %}
            {% set all_uid_pay_num += obj['uid_pay_num'] %}
            {% set all_regist_uid_pay_num += obj['regist_uid_pay_num'] %}
            {% set all_first_uid_pay_num += obj['first_uid_pay_num'] %}
            {% set all_login_uid_pay_num += obj['login_uid_pay_num'] %}
            {% set all_pay_rmb += obj['pay_rmb'] %}
            {% set all_first_uid_pay_rmb += obj['first_uid_pay_rmb'] %}
            <tr onmouseover="return changecolor(this, '#B3D9D9')" onmouseout="return changecolor(this, '')">
                <td>{{ day }}</td>
                <td>{{ select_channel_id }}</td>
                <td>{{ obj['login_num'] }}</td>
                <td>{{ obj['regist_num'] }}</td>
                <td>{{ obj['uid_pay_num'] }}</td>
                <td>{{ obj['regist_uid_pay_num'] }}</td>
                <td>{{ obj['first_uid_pay_num'] }}</td>
                <td>{{ obj['login_uid_pay_num'] }}</td>
                <td>{{ obj['pay_rmb'] }}</td>
                <td>{{ obj['first_uid_pay_rmb'] }}</td>
                <td>{{ obj['pay_rate'] }}</td>
                <td>{{ obj['pay_arpu'] }}</td>
                <td>{{ obj['login_arpu'] }}</td>
            </tr>
        {% end %}
    {% end %}
    <tr onmouseover="return changecolor(this, '#B3D9D9')" onmouseout="return changecolor(this, '')">
        <td colspan="2">总计</td>
        <td>{{ all_login_num }}</td>
        <td>{{ all_regist_num }}</td>
        <td>{{ all_uid_pay_num }}</td>
        <td>{{ all_regist_uid_pay_num }}</td>
        <td>{{ all_first_uid_pay_num }}</td>
        <td>{{ all_login_uid_pay_num }}</td>
        <td>{{ all_pay_rmb }}</td>
        <td>{{ all_first_uid_pay_rmb }}</td>
        <td colspan="3"> </td>
    </tr>
</table>

{% end %}
